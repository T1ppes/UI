---
### Custom Card Senoro Win ###
custom_card_senoro_win:
  template:
    - "icon_info_bg"
    - "ulm_language_variables"
    - "ulm_custom_card_senoro_win_language_variables"
  variables:
    ulm_custom_card_senoro_win_entity: "[[[ return entity.entity_id ]]]"
    ulm_custom_card_senoro_win_handle: ""
    ulm_custom_card_senoro_win_name: ""
    ulm_custom_card_senoro_win_icon: ""
    ulm_custom_card_senoro_win_color: "blue"
    ulm_custom_card_senoro_win_force_background_color: false
    ulm_custom_card_senoro_win_battery_level: ""
    ulm_custom_card_senoro_win_battery_warning: 20
    ulm_custom_card_senoro_win_battery_warning_low: 5
    ulm_show_last_changed: false
  triggers_update: "all"
  name: >
    [[[
      if (variables.ulm_custom_card_senoro_win_name) {
        return variables.ulm_custom_card_senoro_win_name;
      }
      return entity.attributes.friendly_name;
    ]]]
  icon: >
    [[[
      if (variables.ulm_custom_card_senoro_win_icon && variables.ulm_custom_card_senoro_win_icon !== "") {
        return variables.ulm_custom_card_senoro_win_icon;
      }
      return entity.attributes.icon;
    ]]]
  label: >
    [[[
      if (variables.ulm_show_last_changed) {
        return states[entity.entity_id].last_changed;
      }
      const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
      const handle = states[variables.ulm_custom_card_senoro_win_handle].state;
      
      if (contact === "unavailable" || handle === "unavailable"){
        return variables.ulm_unavailable;
      } else if (contact === "off" && handle === "Closed"){
        return variables.ulm_custom_card_senoro_win_locked;
      } else if (contact === "off" && (handle === "Tilted" || handle === "Open")){
        return variables.ulm_custom_card_senoro_win_closed;
      } else if (contact === "on" && handle === "Tilted"){
        return variables.ulm_custom_card_senoro_win_tilted;
      } else if (contact === "on" && handle === "Open"){
        return variables.ulm_custom_card_senoro_win_open;
      } else if (contact === "on" && handle === "Closed"){
        return variables.ulm_custom_card_senoro_win_manipulated;
      }
      return "Unknown";
    ]]]
  state:
    - operator: "template"
      value: >
        [[[
          const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
          return (contact === "on");
        ]]]
      styles:
        icon:
          - color: >
              [[[
                const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
                const handle = states[variables.ulm_custom_card_senoro_win_handle].state;
                
                if (contact === "on"){
                  if (handle === "Closed"){
                    return 'rgba(var(--color-red), 1)';
                  } else {
                    var color = variables.ulm_custom_card_senoro_win_color;
                    return 'rgba(var(--color-' + color + '), 1)';
                  }
                }
              ]]]
        img_cell:
          - background-color: >
              [[[
                const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
                const handle = states[variables.ulm_custom_card_senoro_win_handle].state;
                
                if (contact === "on"){
                  if (handle === "Closed"){
                    return 'rgba(var(--color-red), 0.2)';
                  } else {
                    var color = variables.ulm_custom_card_senoro_win_color;
                    return 'rgba(var(--color-' + color + '), 0.2)';
                  }
                }
              ]]]
        card:
          - background-color: >
              [[[
                const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
                const handle = states[variables.ulm_custom_card_senoro_win_handle].state;
                
                if (variables.ulm_custom_card_senoro_win_force_background_color) {
                  if (contact === "on" && (handle === "Tilted" || handle === "Open")){
                    var color = variables.ulm_custom_card_senoro_win_color;
                    return 'rgba(var(--color-' + color + '),var(--opacity-bg))';
                  } else if (contact === "on" && handle === "Closed"){
                    return 'rgba(var(--color-red),var(--opacity-bg))';
                  }
                }
              ]]]
  custom_fields:
    notification: >
      [[[
        const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
        const handle = states[variables.ulm_custom_card_senoro_win_handle].state;
        
        if (handle === "Tilted" || handle === "Open"){
           return `<ha-icon icon="mdi:lock-open-variant" style="width: 12px; height: 12px; color: var(--primary-background-color);"></ha-icon>`;
        } else if (contact === "off" && handle === "Closed"){
          return `<ha-icon icon="mdi:lock" style="width: 12px; height: 12px; color: var(--primary-background-color);"></ha-icon>`;
        } else if (contact === "on" && handle === "Closed"){
           return `<ha-icon icon="mdi:alert" style="width: 12px; height: 12px; color: var(--primary-background-color);"></ha-icon>`;
        }
      ]]]
    notification_battery: >
      [[[
        if (variables.ulm_custom_card_senoro_win_battery_level !== "") {
          if (states[variables.ulm_custom_card_senoro_win_battery_level].state <= variables.ulm_custom_card_senoro_win_battery_warning) {
            return `<ha-icon icon="mdi:battery-low" style="width: 12px; height: 12px; color: var(--primary-background-color);"></ha-icon>`;
          }
        }
      ]]]
  styles:
    grid:
      - position: "relative"
    custom_fields:
      notification:
        - border-radius: "50%"
        - position: "absolute"
        - left: "28px"
        - top: "-6px"
        - height: "16px"
        - width: "16px"
        - border: "2px solid var(--card-background-color)"
        - font-size: "12px"
        - line-height: "14px"
        - background-color: >
            [[[
              const contact = states[variables.ulm_custom_card_senoro_win_entity].state;
              const handle = states[variables.ulm_custom_card_senoro_win_handle].state;
              
              if (contact === "off" && handle === "Closed"){
                return "rgba(var(--color-green),1)";
              } else {
                return "rgba(var(--color-red),1)";
              }
            ]]]
      notification_battery:
        - border-radius: "50%"
        - position: "absolute"
        - left: "-6px"
        - top: "-6px"
        - height: "16px"
        - width: "16px"
        - border: "2px solid var(--card-background-color)"
        - font-size: "12px"
        - line-height: "14px"
        - background-color: >
            [[[
              if (variables.ulm_custom_card_senoro_win_battery_level !== "") {
                if (states[variables.ulm_custom_card_senoro_win_battery_level].state <= variables.ulm_custom_card_senoro_win_battery_warning_low) {
                  return "rgba(var(--color-red),1)";
                } else if (states[variables.ulm_custom_card_senoro_win_battery_level].state <= variables.ulm_custom_card_senoro_win_battery_warning) {
                  return "rgba(var(--color-yellow),1)";
                }
              }
            ]]]
